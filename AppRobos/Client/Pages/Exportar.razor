@page "/exportar"
@inject HttpClient Http
@inject NavigationManager navigationManager


@if (personas != null) {
    if (modoMapa) {
<MudGrid>
    <br />
    <MudButton OnClick="@Modo" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">@modoName</MudButton>
    <MudItem xs="12">
        <RadzenGoogleMap style="height: 600px;" Zoom=@zoom Center=@(new Radzen.GoogleMapPosition() { Lat = 18.6176122, Lng = -68.7085308 })>
            <Markers>
                @foreach (var persona in personas) {
                    <RadzenGoogleMapMarker Title="" Label="@persona.Nombres" Position=@(new Radzen.GoogleMapPosition() { Lat = persona.Latitud, Lng = persona.Longitud }) />
                }
            </Markers>
        </RadzenGoogleMap>
    </MudItem>
</MudGrid>
    } else {
        <MudTable Items="@personas" Hover="@true" Striped="@true">
            <ToolBarContent>
                <MudText Typo="Typo.h6">Personas Robadas</MudText>
                <MudButton OnClick="@Modo" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">@modoName</MudButton>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Cedula</MudTh>
                <MudTh>Nombres </MudTh>
                <MudTh>Apellidos</MudTh>
                <MudTh>Provincia</MudTh>
                <MudTh>Objeto Robado</MudTh>
                <MudTh>Precio</MudTh>
                <MudTh>Editar</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Cedula">@context.Cedula</MudTd>
                <MudTd DataLabel="Nombres">@context.Nombres</MudTd>
                <MudTd DataLabel="Apellidos">@context.Apellidos</MudTd>
                <MudTd DataLabel="Provincia">@context.Provincia</MudTd>
                <MudTd DataLabel="Objeto Robado">@context.ObjetoRobado</MudTd>
                <MudTd DataLabel="Precio">@context.PrecioObjetoRobado</MudTd>
                <MudTd DataLabel="Editar"><MudIconButton Icon="@Icons.Material.Filled.Edit" OnClick="() => Editar(context.Id)"></MudIconButton></MudTd>
            </RowTemplate>
        </MudTable>
    }
}

@code {
    string modoName = "Modo Mapa";
    bool modoMapa = false;
    int zoom = 8;
    private List<Persona> personas = new List<Persona>();
    public int Id { get; set; }

    protected override async Task OnInitializedAsync() {
        personas = await Http.GetFromJsonAsync<List<Persona>>("api/personas");
        foreach (var item in personas) {
            Console.WriteLine(item.Latitud);
            Console.WriteLine(item.Longitud);
        }
    }
    void Editar(int Id) {
        navigationManager.NavigateTo($"editar/{Id.ToString()}");
    }

    private void Modo() {
        if (modoMapa) {
            modoName = "Modo Mapa";
            modoMapa = false;
        } else {
            modoMapa = true;
            modoName = "Modo Lista";
        }

    }

}